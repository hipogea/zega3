<?php/* * ENCAPSULA LA FUNCION CHTML::IMAGE * VERIFICA LA RUTA SI ES UN DRECTORIO VALIDO  * Y CONSULTA SI EXISTE EL PARAMETRO YII::SETTINGS->RUTAIMAGEN *  */Yii::import('application.extensions.image.CImageComponent');/** * Description of CImageComponent * * @author Administrator */class Imagen extends CImageComponent{       public $rutadirectorio; //directorio de miagenes generales de la aplicacion    public $nombrefotoanonima; //no foto     public $sourcepath=null; //7ruta de disco desde donde la imagen se ha cargado    public function init()    {        $this->rutadirectorio=Yii::getPathOfAlias('webroot').yii::app()->settings->get('general','general_directorioimg');        $this->nombrefotoanonima=yii::app()->settings->get('general','general_imagenophoto');//verificando si esta establecida la imagen por defecto apra mostrar cunado no encuentra imagfen     if(!is_dir($this->rutadirectorio))        throw new CException('No existe el directorio de imagenes, revise la propiedad de co0nfiguracion del sistema');     if(!is_file($this->rutadirectorio.DIRECTORY_SEPARATOR.$this->nombrefotoanonima))        throw new CException("No existe el archivo ".$this->nombrefotoanonima."  en el directorio  ". yii::app()->settings->get('general','general_directorioimg')." ");       $this->createVersion(2);        $this->createVersion(3);                         parent::init();            } //obtiene la ruta de la foto nodisponible private function getNoPhoto(){        return $this->rutadirectorio.DIRECTORY_SEPARATOR.$this->nombrefotoanonima;    }public function loadNoPhoto(){    /*VAR_DUMP($this->rutadirectorio.DIRECTORY_SEPARATOR.$this->nombrefotoanonima);   VAR_DUMP($this->getNoPhoto());DIE();*/  return  $this->load($this->getNoPhoto());}private function createVersion($level=null){    //$ruta=$this->getNoPhoto();    if ($level==2){        $quality=40;    }elseif($level==3){      $quality=20;      }else{       $quality=100;       }    if($quality !=100){ $pathNewImage=$this->renamePath($this->getNoPhoto(), $level);    if(!is_file($pathNewImage)){        $newImage=$this->loadNoPhoto()->quality($quality);        $newImage->save($pathNewImage);     }            }}private function shortPath($path){    return yii::app()->baseUrl.str_replace(Yii::getPathOfAlias('webroot'),'',$path);}private function longPath($path){    return Yii::getPathOfAlias('webroot').str_replace(yii::app()->baseUrl,'',$path);}private function renamePath($path,$level){     $partes=explode(".",$path);    return $partes[0]."_".$level.".".$partes[1];}private function getVersion($level=1){    if(in_array($level,array(3,2))){                     return $this->shortPath($this->renamePath($this->getNoPhoto(), $level));       }else{        return $this->shortPath($this->getNoPhoto());      }}/* * Encapsula la funcion CHTML image * @level: 1 baja resolucion, 2, media resilñicion, 3:  resolucion igual al archivo */ public function putImage($ruta,$alt='',$htmlOptions=array(),$level=1){    // var_dump($this->longPath($ruta));die();   if (!is_file($this->longPath($ruta)))   $ruta=$this->getVersion($level);  return CHtml::image($ruta,$alt,$htmlOptions); }          }?>